<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CVG GMAO - Live</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --primary: #002b5c; --danger: #ef4444; --success: #22c55e; --bg: #f8fafc; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background: var(--bg); padding: 10px; }
        .app-container { max-width: 500px; margin: 0 auto; }
        header { background: var(--primary); color: white; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #64748b; font-size: 0.9rem; }
        select { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e2e8f0; font-size: 16px; margin-bottom: 15px; }
        .btn-send { width: 100%; padding: 15px; background: var(--danger); color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        .notif-item { background: white; border-left: 5px solid var(--danger); padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .btn-ok { background: var(--success); color: white; border: none; padding: 8px 15px; border-radius: 6px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <h3>CVG GMAO <span>LIVE</span></h3>
            <div style="font-size: 0.7rem; color: #22c55e;"><i class="fas fa-circle"></i> Connected</div>
        </header>

        <div class="card">
            <label>Machine</label>
            <select id="machineSelect">
                <option value="KOMAX-01">KOMAX 01</option>
                <option value="SCHUNK-04">SCHUNK 04</option>
                <option value="BAN-TEST-02">BANC TEST 02</option>
            </select>
            <label>Type de Panne</label>
            <select id="panneType">
                <option value="M√©canique">üîß M√©canique</option>
                <option value="√âlectrique">‚ö° √âlectrique</option>
                <option value="Qualit√©">‚ùå Qualit√©</option>
            </select>
            <button class="btn-send" onclick="sendAlert()">SAYFAT ALERTE</button>
        </div>

        <div id="notifList"></div>
    </div>

    <script>
        // L-Config dyalk l-vrai
        const firebaseConfig = {
            apiKey: "AIzaSyASQa5cLXFllnV6EmYp-ARZ9dndWSKha6c",
            authDomain: "cvgmaroc-gmao.firebaseapp.com",
            databaseURL: "https://cvgmaroc-gmao-default-rtdb.firebaseio.com",
            projectId: "cvgmaroc-gmao",
            storageBucket: "cvgmaroc-gmao.firebasestorage.app",
            messagingSenderId: "72908747564",
            appId: "1:72908747564:web:82f646ef5dd209d03b7289",
            measurementId: "G-FP17SNE4VB"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // 1. Send Alert
        function sendAlert() {
            const machine = document.getElementById('machineSelect').value;
            const type = document.getElementById('panneType').value;
            const time = new Date().toLocaleTimeString('fr-FR');
            
            database.ref('pannes/').push({
                machine: machine,
                type: type,
                time: time,
                status: 'OPEN'
            }).then(() => alert("Alerte envoy√©e !"));
        }

        // 2. Real-time Listener
        database.ref('pannes/').on('value', (snapshot) => {
            const data = snapshot.val();
            const container = document.getElementById('notifList');
            container.innerHTML = "";
            if (data) {
                Object.keys(data).reverse().forEach(key => {
                    const p = data[key];
                    if(p.status === 'OPEN') {
                        container.innerHTML += `
                            <div class="notif-item">
                                <div><b>${p.machine}</b><br><small>${p.type} - ${p.time}</small></div>
                                <button class="btn-ok" onclick="closeP('${key}')">OK</button>
                            </div>`;
                    }
                });
            }
        });

        function closeP(key) { database.ref('pannes/' + key).update({status: 'CLOSED'}); }
    </script>
</body>
</html>
